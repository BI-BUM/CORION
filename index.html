<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>バドミントン試合管理</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f0f4f8;
    }
    h1, h2 { text-align: center; }
    .controls {
      margin-bottom: 20px;
      padding: 15px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #matchType {
      font-size: 3em;
      padding: 10px 12px;
    }
    .controls label {
      display: block;
      margin: 10px 0 5px;
    }
    .controls input[type="range"] {
      display: block;
      width: 300px;        /* 親要素幅いっぱいに */
      height: 20px;       /* バーの高さ */
      margin: 10px auto;  /* 上下余白、左右中央 */
    }
    .court-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    .controls button {
      font-size: 2em;   /* 文字を大きく */
      padding: 10px 20px; /* ボタンの大きさを広げる */
      margin: 5px;         /* ボタン間のスペース */
      border-radius: 10px; /* 角丸 */
    }
    .court {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      width: 200px;
      cursor: pointer;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .court:hover { transform: scale(1.05); }
    .table-container {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    th { background: #eee; }
    .message {
      margin-top: 10px;
      text-align: center;
      font-weight: bold;
      color: #0077cc;
    }
  </style>
</head>
<body>
  <h1>🏸 バドミントン試合管理システム</h1>

  <div class="controls">
    <label>人数: <span id="playerCountLabel">4</span></label>
    <input type="range" id="playerCount" min="2" max="20" value="4">
    
    <label>コート数: <span id="courtCountLabel">2</span></label>
    <input type="range" id="courtCount" min="1" max="10" value="2">

    <label>試合形式:</label>
    <select id="matchType">
      <option value="singles">シングルス</option>
      <option value="doubles">ダブルス</option>
    </select>

    <button id="generate">試合生成</button>
    <button id="addPlayer">プレイヤー追加</button>
    <button id="removePlayer">プレイヤー削除</button>
  </div>

  <h2>コート一覧</h2>
  <div class="court-container" id="courts"></div>

  <div class="table-container">
    <h2>プレイヤー番号表</h2>
    <table id="playerTable">
      <thead>
        <tr><th>番号</th><th>状態</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="message" id="message"></div>

  <script>
    let players = [];
    let matches = [];
    let courts = [];
    let currentMatchIndex = [];

    const playerCountInput = document.getElementById("playerCount");
    const courtCountInput = document.getElementById("courtCount");
    const matchTypeInput = document.getElementById("matchType");
    const courtsDiv = document.getElementById("courts");
    const messageDiv = document.getElementById("message");
    const playerTableBody = document.querySelector("#playerTable tbody");

    function updateLabels() {
      document.getElementById("playerCountLabel").innerText = playerCountInput.value;
      document.getElementById("courtCountLabel").innerText = courtCountInput.value;
    }

    function updatePlayerTable() {
      playerTableBody.innerHTML = "";
      let maxNumber = Math.max(...players.map(p => p.id), playerCountInput.value);
      for (let i = 1; i <= maxNumber; i++) {
        let row = document.createElement("tr");
        let player = players.find(p => p.id === i);
        row.innerHTML = `<td>${i}</td><td>${player ? "参加中" : "空席"}</td>`;
        playerTableBody.appendChild(row);
      }
    }

    function generatePlayers() {
      let n = parseInt(playerCountInput.value);
      let existingIds = players.map(p => p.id);
      players = [];
      for (let i = 1; i <= n; i++) {
        players.push({id: i});
      }
      updatePlayerTable();
    }

    function generateMatches() {
      let type = matchTypeInput.value;
      let groupSize = (type === "singles") ? 2 : 4;
      let shuffled = [...players].sort(() => Math.random() - 0.5);
      matches = [];
      for (let i = 0; i < shuffled.length; i += groupSize) {
        if (i + groupSize <= shuffled.length) {
          matches.push(shuffled.slice(i, i + groupSize));
        }
      }
    }

    function generateCourts() {
      let c = parseInt(courtCountInput.value);
      courts = Array.from({length: c}, (_, i) => i);
      currentMatchIndex = new Array(c).fill(0);
      renderCourts();
    }

    function renderCourts() {
      courtsDiv.innerHTML = "";
      courts.forEach((court, index) => {
        let match = matches[currentMatchIndex[index]];
        let div = document.createElement("div");
        div.className = "court";
        div.onclick = () => nextMatch(index);
        div.innerHTML = `
          <h3>コート ${index+1}</h3>
          <p>${match ? match.map(p => p.id).join(" vs ") : "試合なし"}</p>
        `;
        courtsDiv.appendChild(div);
      });
    }

    function nextMatch(courtIndex) {
      if (currentMatchIndex[courtIndex] < matches.length - 1) {
        currentMatchIndex[courtIndex]++;
      } else {
        currentMatchIndex[courtIndex] = 0;
      }
      renderCourts();
    }

    function addPlayer() {
      // 空席を探す
      let maxNumber = Math.max(...players.map(p => p.id), playerCountInput.value);
      let empty = [];
      for (let i = 1; i <= maxNumber; i++) {
        if (!players.find(p => p.id === i)) empty.push(i);
      }

      let newId;
      if (empty.length > 0) {
        newId = empty[0];
      } else {
        newId = maxNumber + 1;
        playerCountInput.value = newId;
      }
      players.push({id: newId});
      updatePlayerTable();
      messageDiv.innerText = `新しく ${newId} 番のプレイヤーが追加されました`;
    }

    function removePlayer() {
      let id = parseInt(prompt("削除するプレイヤー番号を入力してください:"));
      if (isNaN(id)) return;
      let index = players.findIndex(p => p.id === id);
      if (index !== -1) {
        players.splice(index, 1);
        updatePlayerTable();
        messageDiv.innerText = `${id} 番のプレイヤーが削除されました`;
      } else {
        messageDiv.innerText = `${id} 番のプレイヤーは存在しません`;
      }
    }

    document.getElementById("generate").onclick = () => {
      generatePlayers();
      generateMatches();
      generateCourts();
    };
    document.getElementById("addPlayer").onclick = addPlayer;
    document.getElementById("removePlayer").onclick = removePlayer;

    playerCountInput.oninput = () => { updateLabels(); generatePlayers(); };
    courtCountInput.oninput = () => { updateLabels(); generateCourts(); };

    updateLabels();
    generatePlayers();
    generateMatches();
    generateCourts();
  </script>
</body>
</html>
